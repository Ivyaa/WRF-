# -WRF-
ç·¨è­¯ç´€éŒ„/å•é¡Œ/è§£æ±ºæ–¹æ³•/ä¸­æ–‡OuOb

é€™æ˜¯ä¸€å€‹ç·¨è­¯WRFçš„ç´€éŒ„æª”æ¡ˆï¼Œéš¨é€²åº¦æ›´æ–°(ç›®å‰æ¸¬è©¦é€šéClassic WRFåŠWPSç·¨è­¯ï¼Œé‚„æœªåˆ°è¨­å®šéƒ¨åˆ†ï¼Œæ­£åœ¨å˜—è©¦Compression with NC4)
ç´”ç²¹ç´€éŒ„ï¼Œä»¥ä¸‹å…§å®¹çš†ç‚ºæœ¬äººåœ¨ç·¨è­¯éç¨‹ä¸­é‡åˆ°çš„å•é¡Œï¼ŒåŒ…å«ç’°å¢ƒè®Šæ•¸(environment variable)åŠå¥—ä»¶ç‰ˆæœ¬(module)ç­‰ç­‰  

â€»è‹¥æœ‰ä»»ä½•ä¸æ­£ç¢ºçš„è§€å¿µæ­¡è¿æå‡ºğŸ¤£æœ¬äººéè³‡å·¥å°ˆæ¥­ï¼Œåƒ…æ·ºæ·ºçš„å­¸éä¸€é»æ±è¥¿  
â€»ç‰¹åˆ¥æ„Ÿè¬èº«é‚Šçš„å¤§ç¥å­¸é•·ã€å‰å¤§çš„google/chatGPT  
â€»ä¾µæ¬Šåˆª(ï¼Ÿ)

# WRFç‰ˆæœ¬
å®˜ç¶²ï¼šhttps://www2.mmm.ucar.edu/wrf/users/download/get_source.html  
å®‰è£æ•™å­¸ï¼šhttps://www2.mmm.ucar.edu/wrf/OnLineTutorial/compilation_tutorial.php#STEP1  
  
é€™å…©å€‹é€£çµæ˜¯å®˜æ–¹æä¾›çš„ä¸‹è¼‰é»ä»¥åŠæ‰€éœ€libraryçš„ç·¨è­¯éç¨‹ï¼ŒWRFæœ‰è¨±å¤šä¸åŒç‰ˆæœ¬ï¼Œç›®å‰æœ€é«˜æ˜¯WRF4.5ï¼Œå¯ä»¥çœ‹è‡ªå·±éœ€æ±‚å»ä¸‹è¼‰ï¼Œä½†å»ºè­°ä¸è¦ä¸‹è¼‰æœ€æ–°ç‰ˆæœ¬ï¼Œå¯èƒ½æœƒé‡åˆ°å¾ˆå¤šç·¨è­¯å•é¡Œã€‚é€™é‚Šè¦æåˆ°çš„ç‰ˆæœ¬æ˜¯Classicå’ŒCompressionã€‚ç”±æ–¼ä¸€é–‹å§‹æ˜¯å®Œå…¨æŒ‰ç…§å®˜ç¶²çš„æ–¹å¼å»åŸ·è¡Œï¼Œå®Œå…¨æ²’æœ‰æ³¨æ„åˆ°WRF libraryé‚„æœ‰åˆ†Classicã€Compressionçš„å·®åˆ¥ğŸ¤£ï¼Œé€™é‚Šç°¡æ˜“çš„å€åˆ†æ–¹å¼æ˜¯å¦è¦ä½¿ç”¨NC4ã€‚è‹¥åœ¨ç·¨è­¯netcdf-CåŠnetcdf-fortranæ™‚ï¼ŒåŠ å…¥é¸é …--disable-netcdf-4ï¼Œå³æ˜¯ä¸ä½¿ç”¨NC4ï¼Œç†è«–ä¸Šç·¨è­¯å‡ºä¾†çš„WRFå°±æ˜¯Classicç‰ˆæœ¬ï¼Œé€™ä¹Ÿæ˜¯å®˜ç¶²æä¾›çš„ç‰ˆæœ¬ã€‚è‹¥ä¸åŠ å…¥é¸é …--disable-netcdf-4ï¼Œç·¨è­¯WRFçš„æ™‚å€™å°±æœƒè‡ªå‹•ç·¨è­¯æˆCompressionç‰ˆæœ¬ï¼Œä¹Ÿæœƒå‘Šè¨´ä½ é€™å€‹ç‰ˆæœ¬éœ€è¦ä½¿ç”¨NC4ã€‚ç•¶ç„¶ï¼Œé€™å…©ç¨®ç‰ˆæœ¬é‚„æ˜¯æœƒæœ‰å…¶ä»–å€åˆ¥ï¼Œå¦‚æœæœ‰èˆˆè¶£å¯ä»¥ä¸Šå®˜ç¶²æˆ–googleçœ‹ä¸€ä¸‹ã€‚  
  
æœƒå…ˆæé€™å€‹ï¼Œæ˜¯å› ç‚ºå…©è€…å°æ–¼libraryçš„è¦æ±‚ä¸åŒï¼Œç·¨è­¯libraryçš„é †åºã€éœ€è¦æ·»åŠ çš„é¸é …ä¹Ÿä¸ä¸€æ¨£ï¼Œåœ¨ç·¨è­¯çš„æ™‚å€™éœ€è¦æ³¨æ„ï¼Œä¸ç„¶å°±æœƒåƒç­†è€…ä¸€æ¨£ä¸€å€‹WRFç·¨è­¯å¡å¥½ä¹…ï¼Œä½†å…¶å¯¦åªæ˜¯å› ç‚ºå®‰è£netcdf-fortrançš„æ™‚å€™æ²’æ³¨æ„åˆ°é€™å€‹å•é¡Œã€‚ä¸‹é¢å°±ä»¥é€™å…©ç¨®ç‰ˆæœ¬ä½œå€åˆ†ä¾†å®‰è£WRFï½

# Classic verion WRF4.4
å…ˆè¨˜éŒ„ä¸€ä¸‹ä½¿ç”¨ç’°å¢ƒå’ŒLinuxç‰ˆæœ¬  
linux : CentOS 7.9  
ç·¨è­¯å™¨ï¼šicc/2023.1.0  

ç­†è€…æœ€åˆæ˜¯æŒ‰ç…§å®˜ç¶²ï¼Œåœ¨è™›æ“¬æ©Ÿè‡ªè¡Œè£CentOS7å¾Œï¼Œç”¨GNUçš„Cã€FORTRANç·¨è­¯å™¨(gccã€gfortran)ï¼Œå»åšlibraryçš„ç·¨è­¯ï¼Œå¾Œä¾†ç·¨è­¯æ›æˆinteläº†(iccã€icpcã€ifort)ã€‚Linuxçš„éƒ¨åˆ†ï¼Œä¹Ÿæœ‰äººé¸æ“‡Ubuntuæˆ–æ˜¯WSLï¼Œå€‹äººdebugéç¨‹ç¶²è·¯ä¸Šçœ‹ä¸‹ä¾†æ„Ÿè¦ºUbuntuæ˜¯æœ€å¤šäººé¸æ“‡çš„ï¼ŒåŸå› ä¹‹ä¸€å¥½åƒæ˜¯CentOSç³»åˆ—å°æ–¼ç·¨è­¯WRFä¾†è¬›ä¸å¤ªå‹å–„(çœ‹éæœ‰äººè©•è«–CentOSæ˜¯å°åˆç·¨è­¯WRFä¾†èªªæœ€ä¸å‹å–„çš„ä½œæ¥­ç³»çµ±å“ˆå“ˆXD)ã€‚å†ä¾†æ˜¯ä¸è«–ä½¿ç”¨ä½•ç¨®ç·¨è­¯å™¨ã€ä½•ç¨®ç‰ˆæœ¬ï¼Œä¸€å®šè¦å¾é ­åˆ°å°¾éƒ½ç”¨åŒä¸€å€‹ç‰ˆæœ¬çš„ç·¨è­¯å™¨ï¼Œä¸èƒ½èªªä½ ç”¨gcc7ç·¨è­¯libraryã€ç”¨gcc10ç·¨è­¯WRFï¼Œè«‹ä¸è¦é€™æ¨£åšã€‚
## Library
å› ç‚ºWRFæœƒéœ€è¦ä½¿ç”¨åˆ°netcdf-library(åŒ…å«Cå’ŒFORTRAN)ä»¥åŠå…¶ä»–ç›¸ä¾çš„zlibã€libpngã€jasperï¼Œæ‰€ä»¥è¦å…ˆå®‰è£ä¸¦ç·¨è­¯libraryã€‚å¦å¤–è‹¥è¦æ”¯æ´å¹³è¡ŒåŒ–é‹ç®—ï¼Œå°±ä¸€å®šè¦å®‰è£MPIé€™å€‹å·¥å…·ã€‚  
é€™é‚Šæƒ³å…ˆæå€‹ï¼Œç¬¬ä¸€æ¬¡ç·¨è­¯libraryï¼Œç­†è€…ä¹Ÿä¸å¤ªäº†è§£æ‰€è¬‚ã€Œæ¶æ§‹ã€ï¼Œæ˜¯è¢«æäº†ä¸€ä¸‹æœ‰ä¸åŒã€Œæ¶æ§‹ã€çš„libraryï¼Œæ‰é–‹å§‹äº†è§£å®˜ç¶²åœ¨configureå¾Œé¢é™„åŠ çš„ä¸€å †é¸é …ä»£è¡¨ä»€éº¼æ„æ€ã€‚  
é—œæ–¼ã€Œæ¶æ§‹ã€ï¼Œç­†è€…ç°¡å–®ç†è§£ç‚ºå°‡ç·¨è­¯å®Œçš„å‡½å¼åº«æ”¾å…¥ä¸åŒåˆ†é¡çš„è³‡æ–™å¤¾ï¼Œä¾‹å¦‚å®˜ç¶²ä¸Šçš„libraryæ¶æ§‹å¯ä»¥å¤§æ¦‚åœ–è§£æˆï¼š  

>WRFLIB_sharedstd  
>>grib2  
>>>bin  
>>>lib  
>>>include  
>             
>>netcdf  
>>>bin  
>>>lib  
>>>include 
> 

ä½ æœƒåœ¨configureå¾Œé¢çœ‹åˆ°ï¼š
>--prefix=path/to/grib2     #make installå¾ŒæœƒæŒ‡å®šåˆ°æ­¤è³‡æ–™å¤¾  

å°±æ˜¯å°‡ç·¨è­¯å®Œæˆçš„å‡½å¼åº«æ”¾é€²é€™å€‹è³‡æ–™å¤¾ä¸­(æœƒè‡ªè¡Œå»ºç«‹)ï¼Œä¸¦é€²è¡Œç°¡å–®çš„åˆ†é¡(åƒæ˜¯XXXX.hæª”æ¡ˆæœƒæ”¾åœ¨grib2/include/ï¼Œé€™å€‹è³‡æ–™å¤¾åº•ä¸‹ï¼›XXX.soæª”æ¡ˆæœƒæ”¾åœ¨grib2/lib/)  
ç­†è€…ä¹Ÿæœ‰çœ‹åˆ°ä¸åŒæ¶æ§‹çš„å‡½å¼åº«ï¼Œä½†æ˜¯debugå’Œè¨­å®šç’°å¢ƒè®Šæ•¸å¯èƒ½æœƒèŠ±å¾ˆä¹…å°±æ˜¯äº†XDæ±ºå®šå…ˆç…§å®˜ç¶²èµ°ã€‚  
å¦å¤–ï¼Œå¾å®˜ç¶²å¯ä»¥çœ‹åˆ°--disable-sharedçš„é¸é …ï¼Œå³æ˜¯è©¢å•ä½ è¦ä¸è¦è¨­å®šæˆå…±äº«çš„å‡½å¼åº«ï¼Œç­†è€…æœ€å¾Œæ˜¯é¸æ“‡è¨­å®šã€Œshared libraryã€ï¼Œæ‰€ä»¥åœ¨netcdf-cã€netcdf-fortranç·¨è­¯æ™‚ï¼Œåªæœƒä¿ç•™--disable-netcdf-4ã€‚  
å†ä¾†æ˜¯ç·¨è­¯libraryæ˜¯æœ‰é †åºå·®ç•°çš„ï¼Œä¾‹å¦‚å®‰è£netcdf-fortranå‰ï¼Œä¸€å®šè¦å…ˆå®‰è£netcdf-cï¼Œä¸ç„¶æœƒå ±éŒ¯ã€‚é€™é‚Šå¯ä»¥æŒ‰ç…§å®˜ç¶²çš„é †åºå®‰è£ï¼Œä½†ç­†è€…æœƒæŒ‰ç…§ä»¥ä¸‹é †åºå»èµ°(å¤§ç¥çš„æ™ºæ…§)ï¼šMPI >> zlib >> netcdf-c >> netcdf-fortran >> libpng >> jasper  

æœ€å¾Œå°±æ˜¯æ¯ä¸€æ¬¡ç·¨è­¯æ™‚ï¼Œå¯ä»¥å…ˆçœ‹çœ‹æ¯å€‹libraryçš„å®‰è£æ–‡ä»¶(INSTALL)ï¼Œé€šå¸¸æœƒå¯«å®‰è£ç´°ç¯€ã€å¯æ·»åŠ çš„é¸é …ä»¥åŠå¯èƒ½æœƒé‡åˆ°çš„bugï¼Œäº‹å…ˆé–±è®€æ¸›å°‘debugæ™‚é–“ã€‚

### Environment variable
é€™å€‹æ­¥é©Ÿå±¬å¯¦è¤‡é›œï¼Œå› ç‚ºæœ‰å¤ªå¤šç’°å¢ƒåƒæ•¸å¯ä»¥èª¿  
ä¾‹å¦‚ï¼Œç­†è€…ä½¿ç”¨CentOS7ï¼Œä¾¿å«æœ‰å…§å»ºçš„gcc4.8.5ï¼Œä½†ç­†è€…æƒ³è¦ä½¿ç”¨intel icc/icpc/ifortï¼Œå°±è¦è¨­å®šå¥½å¦‚ä»¥ä¸‹ï¼š  
>export CC="icc"  
>export CPP="icc -E"  
>export CXXCPP="icpc -E"  
>export FC="ifort -E"  
>export F77="ifort -E"

intelæœ¬èº«é‚„æœ‰è¨±å¤šå„ªåŒ–è¨­å®šï¼Œå¯ä»¥ä¸Šå®˜ç¶²æŸ¥è©¢ã€‚  
æ¥ä¸‹ä¾†æ¯å®‰è£å®Œä¸€å€‹Libraryï¼Œå°±æœƒé€²è¡Œä¸€æ¬¡ç’°å¢ƒè®Šæ•¸çš„è¨­å®šï¼Œä¸»è¦ç›®çš„å°±æ˜¯åœ¨ç·¨è­¯libraryå’ŒWRF/WPSæ™‚ï¼Œå‘Šè¨´ä»–å€‘è¦ä½¿ç”¨åˆ°çš„å·¥å…·åœ¨å“ªè£¡ï¼Œè¦ä½¿ç”¨çš„å·¥å…·(å«ç‰ˆæœ¬)åˆæ˜¯ä»€éº¼ã€‚  

### Install zlib
ç”±æ–¼ç­†è€…ä½¿ç”¨çš„ç’°å¢ƒæœ‰äº‹å…ˆä¸‹è¼‰Intel mpiï¼Œå·²ç¶“åŒ…å«mpiå¥—ä»¶ï¼Œæ²’æœ‰é€™å€‹å¥—ä»¶å¯ä»¥å…ˆä¸‹è¼‰ä¾†å®‰è£ã€‚åœ¨å®‰è£zlib(æˆ–æ˜¯mpi/mpich)ä¹‹å‰ï¼Œå¼·çƒˆå»ºè­°æ‰€æœ‰ç”¨GNUç·¨è­¯å™¨ã€ä¸¦ä¸”æ˜¯åœ¨CentOS7ç’°å¢ƒä¸‹çš„ä½¿ç”¨è€…ï¼Œå…ˆæƒ³è¾¦æ³•å‡ç´šgccçš„ç‰ˆæœ¬ï¼Œç”±æ–¼CentOS7åŸæœ¬çš„ç‰ˆæœ¬æ˜¯gcc4.8.5(å¤ªè€èˆŠäº†)ï¼Œæœ‰æ™‚å€™åœ¨å¾ŒçºŒå®‰è£æœƒç¼ºå°‘ä¸€äº›gccå¾ŒçºŒç‰ˆæœ¬æœƒæœ‰çš„å¥—ä»¶ï¼Œå¦‚æœå¾ŒçºŒæ‰å‡ç´šå¥—ä»¶ï¼Œåˆæœƒç¢°åˆ°å‰é¢æåˆ°çš„ç”¨ä¸åŒç‰ˆæœ¬ç·¨è­¯å™¨å»ç·¨è­¯libraryçš„å•é¡Œï¼Œç›´æ¥ç æ‰é‡ç·´ï¼Œå»ºè­°å‡åˆ°gcc7ä»¥ä¸Šã€‚  
å®‰è£zlibéç¨‹åŸºæœ¬ä¸ŠæŒ‰ç…§å®˜ç¶²èµ°ï¼ŒæŒ‡å®šçš„è³‡æ–™å¤¾æ˜¯grib2ã€‚å®‰è£å®Œå¾Œï¼Œä½ æœƒåœ¨ä½ æŒ‡å®šçš„è·¯å¾‘ä¸­æ‰¾åˆ°grib2çš„è³‡æ–™å¤¾ï¼Œè£¡é¢åŒ…å«bin/lib/include/shareç­‰ç­‰ã€‚æ¥è‘—ï¼Œè¦é€éè¨­å®šç’°å¢ƒè®Šæ•¸LD_LIBRARY_PATHï¼Œå°‡zlibå‡½å¼åº«è·¯å¾‘å‘ŠçŸ¥ç³»çµ±ï¼Œä»¥ä¾¿å¾ŒçºŒå®‰è£netcdf-c,fortrançš„æ™‚å€™ï¼Œç³»çµ±å¯ä»¥é€éé€™å€‹ç’°å¢ƒè®Šæ•¸ä¾†æ‰¾åˆ°éœ€è¦çš„å‡½å¼åº«ã€‚æ­¤å¤–é‚„éœ€è¦è¨­å®šä¸€äº›å…¶ä»–çš„ç’°å¢ƒè®Šæ•¸ï¼Œç›®å‰å®‰è£ä¸‹ä¾†ï¼Œæ¯”è¼ƒé‡è¦çš„äº”å€‹ç’°å¢ƒè®Šæ•¸æœ‰ï¼š  
>LIBS="-L$PATH_TO_YOUR_GRIB2_LIB"  
>CFLAGS="-I$PATH_TO_YOUR_GRIB2_INCLUDE"  
>LDFLAGS="-L$PATH_TO_YOUR_GRIB2_LIB"  
>CPPFLAGS="-I$PATH_TO_YOUR_GRIB2_INCLUDE"  
>FFLAGS="-I$PATH_TO_YOUR_GRIB2_INCLUDE"  

å«LD_LIBRARY_PATHåœ¨å…§ï¼Œé€™å…­å€‹ç’°å¢ƒè®Šæ•¸çš„ä¸€å®šè¦è¨­å®šå¥½ï¼Œä¸ç„¶å¾…æœƒå®‰è£netcdf-cçš„æ™‚å€™ï¼Œæœ‰å¯èƒ½æœƒæ‰¾ä¸åˆ°å­˜æ”¾zlibå‡½å¼åº«çš„ä½å€ï¼Œç•¶ç„¶å¦‚æœæƒ³è¦æ¯”è¼ƒå…¨é¢ï¼Œæˆ–æ˜¯ç³»çµ±ä¸åŒå°è‡´ç’°å¢ƒè®Šæ•¸è¨­å®šä¸ä¸€æ¨£ï¼Œæ›´å¤šå…¶ä»–çš„ç’°å¢ƒè®Šæ•¸è¨­å®šå¯ä»¥åƒè€ƒé€™ä¸€ç¯‡æ–‡ç« ï¼šhttps://apolo-docs.readthedocs.io/en/latest/software/scientific_libraries/Zlib/Zlib-1.2.11-Intel/index.html#zlib-1-2-11-intel  

ç¢ºèªåŠ å…¥å¥½ç’°å¢ƒè®Šæ•¸ï¼Œå°±å¯ä»¥é€²å…¥åˆ°å®‰è£netcdf-cå’Œnetcdf-fortrançš„éƒ¨åˆ†å•¦ï¼  

### Install netcdf-c and netcdf-fortran




# åƒè€ƒè³‡æ–™
1. https://apolo-docs.readthedocs.io/en/latest/software/applications/wrf/4.1.1/installation-dependencies.html
2. 
